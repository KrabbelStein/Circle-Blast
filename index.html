<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Circle Blast</title>

<style>
html,body {
  margin:0;
  padding:0;
  height:100%;
  background:#0b0b0f;
  color:#fff;
  font-family: system-ui;
}
#game { width:100%; height:100%; }
.ui {
  position:absolute;
  top:12px;
  left:12px;
  z-index:10;
}
.btn {
  background:#1f2937;
  color:white;
  border:none;
  padding:8px 12px;
  border-radius:8px;
  font-weight:600;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
</head>
<body>

<div id="game"></div>

<div class="ui">
  <span id="score">Score: 0</span>
  <button class="btn" id="start">Start</button>
  <button class="btn" id="reset">Reset</button>
</div>

<script>
const MAX = 6;
const SPAWN_DELAY = 1200;

const game = new Phaser.Game({
  type: Phaser.AUTO,
  parent: 'game',
  width: window.innerWidth,
  height: window.innerHeight,
  backgroundColor: '#0b0b0f',
  scene: { create }
});

function create() {
  const scene = this;
  const scoreEl = document.getElementById('score');

  let score = 0;
  let running = false;
  let spawnTimer = null;

  const circles = [];

  function spawn() {
    if (!running || circles.length >= MAX) return;

    const r = Phaser.Math.Between(20, 35);
    const x = Phaser.Math.Between(r, scene.scale.width - r);
    const y = Phaser.Math.Between(80, scene.scale.height - r);

    const g = scene.add.graphics({ x, y });
    g.fillStyle(Phaser.Display.Color.RandomRGB().color, 1);
    g.fillCircle(0, 0, r);
    g.setInteractive(
      new Phaser.Geom.Circle(0, 0, r),
      Phaser.Geom.Circle.Contains
    );

    const obj = { g, dead:false };
    circles.push(obj);

    g.on('pointerdown', () => blast(obj));

    obj.timer = scene.time.delayedCall(
      6000,
      () => remove(obj)
    );
  }

  function blast(obj) {
    if (obj.dead) return;
    obj.dead = true;

    obj.timer?.remove(false);
    score += 10;
    scoreEl.textContent = 'Score: ' + score;

    scene.tweens.add({
      targets: obj.g,
      scale: 0,
      duration: 250,
      onComplete: () => remove(obj)
    });
  }

  function remove(obj) {
    if (!obj || obj.g.destroyed) return;
    obj.dead = true;
    obj.g.removeAllListeners();
    obj.g.destroy();
    const i = circles.indexOf(obj);
    if (i !== -1) circles.splice(i,1);
  }

  function start() {
    reset();
    running = true;
    spawnTimer = scene.time.addEvent({
      delay: SPAWN_DELAY,
      loop: true,
      callback: spawn
    });
    for (let i=0;i<3;i++) spawn();
  }

  function reset() {
    running = false;
    spawnTimer?.remove(false);
    spawnTimer = null;
    circles.slice().forEach(remove);
    circles.length = 0;
    score = 0;
    scoreEl.textContent = 'Score: 0';
  }

  document.getElementById('start').onclick = start;
  document.getElementById('reset').onclick = reset;
}
</script>
</body>
</html>
